---
title: mapreduce 和 spark 任务对比
date: 2017-11-03 21:54:03
tags:
 - bigdata
categories: Bigdata
---

记录下任务在不同框架下的运行时间对比。

<!--more-->

## svm 分类任务

该任务对简单的文本根据内容进行分类。

首先，训练集中对文本进行了标记，包括positive,negative和neutral三类，通过机器学习算法，训练出模型，该模型的学习目标是根据句子里的词语出现频率判断整句话的类别，即性质，这句话是积极的或是消极的。

简单的算法是先对句子进行分词，然后过滤一些无用的词语，在计算每个词语的tfidf值，每个句子生成一个向量，词直接作为维度，这样虽然会导致整个向量空间的维度很大，有差不多2000维，但是我们这个算法比较简单，没有考虑更多。其实最后的结果比较差，但作为熟悉分布式计算框架开发的实验也就够了。

在之前的训练过程，没有使用分布式计算框架，使用SVM算法训练得到模型，后面对新爬取的文本进行分类时要读取这个模型。同时这一部分也计算得到一个包含训练集中出现的词语的idf数值的文件。其实这里选择向量空间时可以截取词频数比较高的一部分词语作为向量空间的维度 ，能一定程度上控制向量维度。。。

之后对爬取的文本进行分类，也是先文本处理，分词，对每句话生成一个向量，然后就可以用SVM算法以之前训练得到的模型用在每个样本上进行分类。这一部分用了大数据的开发框架，

事实上这一部分并没有特别多的计算过程，主要是数据量比较大（理想上），机器学习里计算量比较大的应该是训练的部分，但是本次试验的训练数据集样本较少，单机就能完成，所以并没有用分布式框架进行训练。

## 运行比较

### MapReduce

mapreduce 在处理大量小文件时，直接使用默认的TextInputFormat会导致运行效率极慢，在之前测试的3700多个小文件的数据集上进行任务的执行，需要一小时5分钟，而将所有的小文件合并成一个大文件后，运行时间只需要21秒。

通常，在处理大量小文件时，需要修改inputFormat的类型，一般使用的是CombineFileInputFormat，这是一个抽象类，用户需要在自己的代码中定义一个新类，继承CombineFileInputFormat，并实现一些接口。参考[MapReduce小文件处理之CombineFileInputFormat实现](http://blog.csdn.net/opensure/article/details/46438721).

``` bash
sh600008首创股份.txt        3.0 南国置业：蹭热点有玄机 高管却大规模减持
sh600008首创股份.txt        3.0 百只个股贡献收益2.68万亿元 银行等三行业“奶牛”扎堆
sh600008首创股份.txt        3.0 政策利好叠加中报预喜 6只PPP概念股被机构集中看好
sh600008首创股份.txt        3.0 深度解读北控系的“三好生”——北控水务(00371)
sh600008首创股份.txt        3.0 首创股份推进PPP资产证券化 拓展新业态
sh600008首创股份.txt        3.0 A股上半年十大牛熊股出炉 下半年选股还看业绩
sh600008首创股份.txt        3.0 【数据揭秘】融资客最看好个股一览
sh600008首创股份.txt        3.0 行业年报：水务行业2016年年报梳理及评级跟踪
sh600008首创股份.txt        3.0 炒作题材效应递减 雄安新区股操作难度加大
sh600008首创股份.txt        3.0 “老牌”企业深耕环保行业 “A/H股+新三板”频现
sh600008首创股份.txt        3.0 谁被雄安概念闪了腰？“百日”炒作渐渐落幕
sh600008首创股份.txt        3.0 回望雄安概念行情百日：选股去伪存真 投资层层递进
sh600008首创股份.txt        3.0 首创股份拟32亿元投资多个项目 公司业务拓展迅速
sh600008首创股份.txt        3.0 首创股份业务拓展迅速 拟斥资33亿元投多个项目
sh600008首创股份.txt        3.0 首创股份：看好公司投资规模扩张潜力？增持评级
sh600008首创股份.txt        3.0 A股入MSCI满月：222只概念股中7成上涨 20股创新高
sh600008首创股份.txt        3.0 操盘手赠言：如何寻找主力强庄股，买一次赚一次！
sh600008首创股份.txt        3.0 重大利好：首创股份 厦门国贸 天齐锂业 上海机场
sh600008首创股份.txt        3.0 重大利好 首创股份 天齐锂业 厦门国贸 四川双马
sh600008首创股份.txt        3.0 非常实用的买卖铁律，秘诀只需一根线，早学早赚到！
sh600008首创股份.txt        3.0 一个顶尖操盘手实录：为什么散户总是亏钱
sh600008首创股份.txt        3.0 七省市公开环保整改方案 攻坚气水土治理
sh600008首创股份.txt        3.0 快讯：雄安概念股集体拉升 京汉股份涨停
sh600008首创股份.txt        3.0 雄安主题启动超跌反弹行情 7只雄安概念股蓄势待发
sh600008首创股份.txt        3.0 雄安新区建设规划预期增强 新龙头带来新畅想
sh600008首创股份.txt        3.0 为什么股市中你赚不了钱，因为你不懂集合竞价！
sh600008首创股份.txt        3.0 多重利好助涨污水处理板块 5.5亿资金抢筹8只龙头股
sh600008首创股份.txt        3.0 雄安题材卷土重来 超七成个股上涨背后哪些公司有料
sh600008首创股份.txt        3.0 雄安投资公司横空出世 概念股或再迎机遇
sh600008首创股份.txt        3.0 首创股份拟投资5处PPP项目 总耗资约33.85亿元
sh600008首创股份.txt        3.0 首创股份拟34亿元投资5个PPP项目
sh600008首创股份.txt        3.0 股海导航 8月11日沪深股市公告提示
sh600008首创股份.txt        3.0 雄安主题酝酿第二波行情 7只国家队重仓股引关注
sh600008首创股份.txt        3.0 一位操盘手的赠言：获利至今仅用一招，亿万散户收藏
sh600008首创股份.txt        3.0 快讯：雄安概念股盘中再受追捧 首创股份涨停
sh600008首创股份.txt        3.0 500之后望600 “酒疯子”茅台慎防“灰犀牛”
sh600008首创股份.txt        3.0 首创股份中标17.75亿饮水工程PPP项目
sh600008首创股份.txt        3.0 涨停板早知道：七大利好明日有望发酵
...
```


## Spark

spark在处理大量小文件时的用时大约是两分钟，处理一个大文件时用时23秒，比mapreduce稍慢一点。

``` bash
(sh600000,3.0 呷哺呷哺(00520)认购1.5亿元浦发银行金融产品)
(sh600000,3.0 探访茅台实体店：最严限价令下的失衡供需)
(sh600000,3.0 这些国家队重仓股 还被机构看好)
(sh600000,3.0 银行股脉冲式上演逆袭行情 工商银行股价创下9年新高)
(sh600000,3.0 估值修复遇上业绩超预期 银行股演绎“王者归来”)
(sh600000,3.0 郑煤机(00564-HK)认购浦发银行2亿元人民币理财产品)
(sh600000,3.0 茅台成25年A股第一高价股 总市值超半个贵州GDP)
(sh600000,3.0 同业存单减速 中小行最受伤)
(sh600000,3.0 深交所与浦发银行开展战略合作 促进金融和科技融合)
(sh600000,3.0 深交所与浦发开展战略合作 推动金融和科技深度融合)
(sh600000,3.0 麦当劳今天宣布：2700多家餐厅归中国公司了)
(sh600000,3.0 健康元隐瞒多次环保处罚 324亿市值蒸发配股股民苦)
(sh600000,3.0 健康元隐瞒多次环保处罚? 324亿市值蒸发股民苦)
(sh600000,2.0 A股1年IPO才募2400亿:银行股半年融资5千亿 光大最猛)
(sh600000,3.0 国家队增持南京银行 持股4.99%逼近举牌线)
(sh600000,2.0 透视银行股大涨之谜：国家队增持南京银行逼近举牌线)
(sh600000,3.0 专题报告：环杭州湾大湾区与粤港澳湾区的对比分析)
(sh600000,3.0 南京银行核心一级资本充足率告急 拟定增140亿元补血)
(sh600000,3.0 历史遗留问题拖累业绩 正虹科技重组预期降温)
(sh600000,3.0 浦发银行同业业务违规被罚款200万 违反审慎经营规则)
(sh600000,3.0 跨界大王群兴玩具:我有故事你带钱 九年盈利不抵减持)
(sh600000,3.0 上市银行屡吃罚单 中介机构:不构成重大违法违规)
(sh600000,2.0 浦发银行谢伟：银行资管业务未来发展空间巨大)
(sh600000,3.0 浦发广州分行领200万同业罚单 同业依赖症走向终结)
(sh600000,3.0 惠而浦遭遇财务“黑天鹅” 复牌后领跌家用电器板块)
(sh600000,3.0 机构扎堆银行股 股价创新高未来分歧加重)
(sh600000,3.0 健康元配股遭监管问询 环保及安全生产疑有隐情)
(sh600000,3.0 银行股纷纷刷新十年高点 6124点工行持股宣告解套)
(sh600000,3.0 证金公司首次现身创业板十大股东 成昆仑万维第一大流通股东)
(sh600000,3.0 6124点买的超级大盘股已解套 这个板块还有大机会？)
(sh600000,3.0 银行股国家队股东逾千亿元分红 9家股价创近两年新高)
(sh600000,2.0 周一董秘速递：大智慧董秘陈志上任四个月就让位)
(sh600000,3.0 世界500强榜单刷屏：前五中国占三席 银行军团集体下滑)
(sh600000,3.0 A股入MSCI满月：222只概念股中7成上涨 20股创新高)
(sh600000,3.0 呷哺呷哺认购交行1.5亿理财产品及浦发银行1.3亿金融产品)
(sh600000,5.0 9个月70亿定增，银联、浦发、人保加入神州优车地表最强战队)
(sh600000,3.0 乐视仅还清3家银行贷款 中信和浦发等仍存风险敞口)
(sh600000,3.0 300亿or9千万不重要！浦发卡被冒名办理才细思极恐)
...
```